// ==UserScript==
// @name          FFZ Hide Purchase Options
// @namespace     dynamite-andy
// @version       3.0.3
// @iconURL       https://github.com/andrewcartwright1/ffz-hide-purchase-options/blob/main/src/resources/icons/favicon32x32.ico?raw=true
// @icon64URL     https://github.com/andrewcartwright1/ffz-hide-purchase-options/blob/main/src/resources/icons/favicon64x64.ico?raw=true
// @updateURL     https://github.com/andrewcartwright1/ffz-hide-purchase-options/raw/main/dist/ffz-hide-purchase-options.min.user.js
// @downloadURL   https://github.com/andrewcartwright1/ffz-hide-purchase-options/raw/main/dist/ffz-hide-purchase-options.min.user.js
// @supportURL    https://github.com/andrewcartwright1/ffz-hide-purchase-options/issues
// @description   Unofficial FFZ addon giving options to remove purchases from twitch
// @author        Dynamite Andy - dynamiteandy@gmail.com
// @include       http://twitch.tv/*
// @include       https://twitch.tv/*
// @include       http://*.twitch.tv/*
// @include       https://*.twitch.tv/*
// @include       http://*.ext-twitch.tv/*
// @include       https://*.ext-twitch.tv/*
// @exclude       http://api.twitch.tv/*
// @exclude       https://api.twitch.tv/*
// @run-at        document-start
// @grant         GM_getValue
// @grant         GM_setValue
// @grant         GM_deleteValue
// @grant         GM_addStyle
// @grant         GM_addValueChangeListener
// ==/UserScript==
(()=>{"use strict";var e,t,s,i;const n="addon.hide_purchase_options",o=class{};o.InIframe="www.twitch.tv"!==window.location.host,o.IsExtension=window.location.host.endsWith("ext-twitch.tv"),o.ConsoleHeading=o.IsExtension?"[hide-purchase-options (Extension)]":"[hide-purchase-options (Twitch)]",o.Styles=((t=class{}).Root="ffz-hide-purchase-options",t.Base="ffz-h-p-hide",t.GiftASub="hide-gift-a-sub",t.ManageYourSub="hide-manage-your-sub",t.Bits="hide-bits",t.Subscribe="hide-subscribe",t.Resubscribe="hide-resubscribe",t.ContinueSub="hide-continue-sub",t.UpdateSub="hide-update-sub",t.CompletePurchase="hide-complete-purchase",t.Subtember="hide-subtember",t.Turbo="hide-turbo",t.HypeChat="hide-hype-chat",t.Charity="hide-charity",t.Extensions=((e=class{}).EmotesShowcase="hide-emotes-showcase",e.LatestFollowers="hide-latest-followers",e.MyEmotes="hide-my-emotes",e.FeaturedViewer="hide-featured-viewer",e),t),o.Settings=((i=class{}).prefix=`${n}.support-panel`,i.GiftASub=`${i.prefix}.gift_a_sub`,i.ManageYourSub=`${i.prefix}.go_above_and_beyond`,i.Bits=`${i.prefix}.bits`,i.ContinueSub=`${i.prefix}.continue_sub`,i.UpdateSub=`${i.prefix}.update_sub`,i.Subscribe=`${i.prefix}.subscribe`,i.Resubscribe=`${i.prefix}.resubscribe`,i.CompletePurchase=`${i.prefix}.complete_purchase`,i.Subtember=`${i.prefix}.subtember`,i.Turbo=`${i.prefix}.turbo`,i.HypeChat=`${i.prefix}.hype_chat`,i.Charity=`${i.prefix}.charity`,i.Extensions=((s=class{}).prefix=`${n}.support-panel.extensions`,s.Text=`${s.prefix}.text`,s.EmotesShowcase=`${s.prefix}.emotes_showcase`,s.LatestFollowers=`${s.prefix}.latest_followers`,s.MyEmotes=`${s.prefix}.my_emotes`,s.FeaturedViewer=`${s.prefix}.featured_viewer`,s),i);let a=o;const u=e=>GM_getValue(e,!0),d=(e,t)=>{GM_setValue(e,t)},r=async(e,t=1e4)=>new Promise((s=>{const i=new Date,n=setInterval((()=>{e()?(clearInterval(n),s(!0)):+new Date-+i>t&&(clearInterval(n),s(!1))}),20)})),b=e=>async(...t)=>e(t),c=async(e,t,s=3)=>{if(0===t.length)return Promise.resolve([]);let i=0;const n=[],o=async()=>{for(;i<t.length;){const e=i++,s="AsyncFunction"!==t[e].task.constructor.name?b(t[e].task):t[e].task;n[e]=await s()}},a=[];for(let e=0;e<s;e++)a.push(o());return await Promise.all(a),n};const l=function(){const e={};return{publish:(t,s)=>{(e[t]??[]).forEach((e=>e(s)))},subscribe:(t,s)=>{const i=e[t]??[];return i.push(s),e[t]=i,s},unsubscribe:(t,s)=>{let i=e[t]??[];i=i.filter((e=>e!==s)),e[t]=i}}}();class p{constructor(e,t,s=!1,i=null){this.applyClass=()=>{const e=u(this.settingId);this.setClass(e,!e,!1)},this.settingId=e,this.styleClass=t,this.tampermonkeySetting=s,this.settingFunction=i}listen(){l.subscribe("styles:reapply",this.applyClass),a.InIframe&&this.tampermonkeySetting?GM_addValueChangeListener(this.settingId,((e,t,s)=>this.setClass(s,t,!1))):a.InIframe||(unsafeWindow.ffz.addons.settings.getChanges(this.settingId,this.setClass.bind(this)),unsafeWindow.ffz.on("chat:room-add",this.applyClass),unsafeWindow.ffz.on("chat:room-remove",this.applyClass)),this.applyClass()}setClass(e,t,s=!0){this.tampermonkeySetting&&s&&d(this.settingId,e),e?document.body.classList.add(this.styleClass):document.body.classList.remove(this.styleClass),this.settingFunction&&this.settingFunction(e)}}const h=()=>{new p(a.Settings.Bits,a.Styles.Bits).listen()},f=async()=>{a.InIframe||await r((()=>null===unsafeWindow.ffz?.site?.elemental._observer));new p(a.Settings.Charity,a.Styles.Charity,!1,(e=>{let t=null;for(const e of[...document.querySelectorAll('[data-target="channel-header-right"] [data-a-target="tw-core-button-label-text"]')])if("Donate to Charity"===e.textContent.trim()){t=e;break}const s=t?.closest("button")?.parentElement,i=document.querySelector('[data-test-selector="chat-room-component-layout"] [aria-label="Charity details"]');e?(s?.classList?.add(a.Styles.Base),i?.classList?.add(a.Styles.Base),i?.previousElementSibling?.classList?.add(a.Styles.Base)):(s?.classList?.remove(a.Styles.Base),i?.classList?.remove(a.Styles.Base),i?.previousElementSibling?.classList?.remove(a.Styles.Base))})).listen()},m=()=>{new p(a.Settings.CompletePurchase,a.Styles.CompletePurchase).listen()},y=()=>{new p(a.Settings.ContinueSub,a.Styles.ContinueSub).listen()},S=()=>{new p(a.Settings.GiftASub,a.Styles.GiftASub,!1,(async e=>{let t=null;const s=await((e,t=document.documentElement,s=1e4)=>new Promise((i=>{if(null===t)return[];if(t===document.documentElement&&(t=document.documentElement),t.querySelector(e))return i([...t.querySelectorAll(e)]);let n;const o=setTimeout((()=>{n.disconnect(),i([])}),s);n=new MutationObserver((()=>{t.querySelector(e)&&(n.disconnect(),clearTimeout(o),i([...t.querySelectorAll(e)]))})),n.observe(t,{childList:!0,subtree:!0})})))('.support-panel [data-a-target="tw-core-button-label-text"]');for(const e of s)if("Gift a Sub"===e.textContent.trim()){t=e;break}const i=t?.closest("button");e?i?.classList?.add(a.Styles.Base):i?.classList?.remove(a.Styles.Base)})).listen()},g=async()=>{a.InIframe||await r((()=>null===unsafeWindow.ffz?.site?.elemental._observer));new p(a.Settings.HypeChat,a.Styles.HypeChat,!1,(e=>{const t=document.querySelector('button[aria-label="Post a Hype Chat"]');e?t?.parentElement?.parentElement?.classList[e?"add":"remove"](a.Styles.Base):t?.parentElement?.parentElement?.classList.remove(a.Styles.Base)})).listen()},w=()=>{new p(a.Settings.ManageYourSub,a.Styles.ManageYourSub).listen()},z=()=>{new p(a.Settings.Resubscribe,a.Styles.Resubscribe).listen()},x="Add-Ons > Hide Purchase Options",C=`${x} >> Purchase Options`,E=`${x} >> Extensions`,k=()=>{a.IsExtension||(unsafeWindow.ffz.addons.settings.addUI("add_ons.hide_purchase_options",{path:C,component:"container"}),unsafeWindow.ffz.addons.settings.add(a.Settings.Bits,{default:!0,ui:{path:C,title:'Hide "Get Bits"',description:'Hides the "Get Bits" payment option',component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(a.Settings.ContinueSub,{default:!0,ui:{path:C,title:'Hide "Continue Sub"',description:'Hides the "Continue Sub" payment option',component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(a.Settings.CompletePurchase,{default:!0,ui:{path:C,title:'Hide "Complete Purchase"',description:'Hides the "Complete Purchase" button',component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(a.Settings.Charity,{default:!0,ui:{path:C,title:'Hide "Donate To Charity"',description:'Hides the "Donate To Charity" payment option',component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(a.Settings.GiftASub,{default:!0,ui:{path:C,title:'Hide "Gift a Sub"',description:'Hides the "Gift a Sub" payment option',component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(a.Settings.HypeChat,{default:!0,ui:{path:C,title:'Hide "Hype Chat"',description:'Hides the "Hype Chat" payment option',component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(a.Settings.ManageYourSub,{default:!0,ui:{path:C,title:'Hide "Manage Your Sub"',description:'Hides the "Manage Your Sub" payment option',component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(a.Settings.Resubscribe,{default:!0,ui:{path:C,title:'Hide "Resubscribe"',description:'Hides the "Resubscribe" payment option',component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(a.Settings.Subscribe,{default:!0,ui:{path:C,title:'Hide "Subscribe"',description:'Hides the "Subscribe" payment option',component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(a.Settings.Subtember,{default:!0,ui:{path:C,title:'Hide "Subtember"',description:'Hides the "Subtember" advert',component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(a.Settings.Turbo,{default:!0,ui:{path:C,title:'Hide "Turbo"',description:'Hides the "Turbo" payment option',component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(a.Settings.UpdateSub,{default:!0,ui:{path:C,title:'Hide "Update Sub"',description:'Hides the "Update Subscription" payment option',component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(a.Settings.Extensions.EmotesShowcase,{default:!0,ui:{path:E,title:'Hide "Emotes Showcase"',description:"Hides payment options on the Emotes Showcase extension",component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(a.Settings.Extensions.FeaturedViewer,{default:!0,ui:{path:E,title:'Hide "Featured Viewer"',description:"Hides payment options on the Featured Viewer extension",component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(a.Settings.Extensions.LatestFollowers,{default:!0,ui:{path:E,title:'Hide "Latest Followers"',description:"Hides payment options on the Latest Followers extension",component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(a.Settings.Extensions.MyEmotes,{default:!0,ui:{path:E,title:'Hide "MyEmotes',description:"Hides payment options on the MyEmotes extension",component:"setting-check-box"}}))},H=()=>document.body.classList.add(a.Styles.Root),v=()=>{H(),GM_addStyle('body.ffz-hide-purchase-options .ffz-h-p-hide{display:none !important}body.ffz-hide-purchase-options.hide-bits button[aria-label=Bits],body.ffz-hide-purchase-options.hide-bits button[data-test-selector=get-bits-button],body.ffz-hide-purchase-options.hide-bits button[data-a-target=top-nav-get-bits-button],body.ffz-hide-purchase-options.hide-bits button[data-a-target=bits-purchase-button-100],body.ffz-hide-purchase-options.hide-bits button[data-a-target=bits-purchase-button-500],body.ffz-hide-purchase-options.hide-bits button[data-a-target=bits-purchase-button-1500],body.ffz-hide-purchase-options.hide-bits button[data-a-target=bits-purchase-button-5000],body.ffz-hide-purchase-options.hide-bits button[data-a-target=bits-purchase-button-10000],body.ffz-hide-purchase-options.hide-bits button[data-a-target=bits-purchase-button-25000],body.ffz-hide-purchase-options.hide-bits a[data-test-selector=test_selector_buy_bits_button]{display:none !important}body.ffz-hide-purchase-options.hide-manage-your-sub button[data-a-target=spm-complete-purchase-button]{display:none !important}body.ffz-hide-purchase-options.hide-continue-sub button[aria-label="Continue Sub"],body.ffz-hide-purchase-options.hide-continue-sub button[aria-label="Continue Sub - 7 Days Remaining"],body.ffz-hide-purchase-options.hide-continue-sub button[aria-label="Continue Sub: 25% off - 7 Days Remaining"],body.ffz-hide-purchase-options.hide-continue-sub button[aria-label="Continue Sub - 6 Days Remaining"],body.ffz-hide-purchase-options.hide-continue-sub button[aria-label="Continue Sub: 25% off - 6 Days Remaining"],body.ffz-hide-purchase-options.hide-continue-sub button[aria-label="Continue Sub - 5 Days Remaining"],body.ffz-hide-purchase-options.hide-continue-sub button[aria-label="Continue Sub: 25% off - 5 Days Remaining"],body.ffz-hide-purchase-options.hide-continue-sub button[aria-label="Continue Sub - 4 Days Remaining"],body.ffz-hide-purchase-options.hide-continue-sub button[aria-label="Continue Sub: 25% off - 4 Days Remaining"],body.ffz-hide-purchase-options.hide-continue-sub button[aria-label="Continue Sub - 3 Days Remaining"],body.ffz-hide-purchase-options.hide-continue-sub button[aria-label="Continue Sub: 25% off - 3 Days Remaining"],body.ffz-hide-purchase-options.hide-continue-sub button[aria-label="Continue Sub - 2 Days Remaining"],body.ffz-hide-purchase-options.hide-continue-sub button[aria-label="Continue Sub: 25% off - 2 Days Remaining"],body.ffz-hide-purchase-options.hide-continue-sub button[aria-label="Continue Sub: 25% off"],body.ffz-hide-purchase-options.hide-continue-sub button[data-test-selector=PaidUpgradeButton]{display:none !important}body.ffz-hide-purchase-options.hide-emotes-showcase a[title=Subscribe],body.ffz-hide-purchase-options.hide-emotes-showcase a[title="Subscribe for"]{display:none !important}body.ffz-hide-purchase-options.hide-emotes-showcase button#overlaysub{display:none !important}body.ffz-hide-purchase-options.hide-featured-viewer button.shoutout__button--me{display:none !important}body.ffz-hide-purchase-options.hide-latest-followers[data-active=recent] #recent-panel .btn.buy{display:none !important}body.ffz-hide-purchase-options.hide-my-emotes #root .extension-mode-navigation a[href*="https://twitch.tv/subs/"]{display:none !important}body.ffz-hide-purchase-options.hide-gift-a-sub button[aria-label="Gift a Sub"],body.ffz-hide-purchase-options.hide-gift-a-sub button[aria-label="Gift a Sub: 25% off"],body.ffz-hide-purchase-options.hide-gift-a-sub button[data-test-selector=gift-subscribe-button],body.ffz-hide-purchase-options.hide-gift-a-sub button[data-test-selector=take-the-leaderboard-prompt-button]{display:none !important}body.ffz-hide-purchase-options.hide-hype-chat button[aria-label="Hype Chat"]{display:none !important}body.ffz-hide-purchase-options.hide-manage-your-sub button[aria-label="Manage Your Sub: 25% off"],body.ffz-hide-purchase-options.hide-manage-your-sub button[aria-label="Manage Your Sub"]{display:none !important}body.ffz-hide-purchase-options.hide-resubscribe button[aria-label="Resubscribe: 25% off"],body.ffz-hide-purchase-options.hide-resubscribe button[aria-label=Resubscribe]{display:none !important}body.ffz-hide-purchase-options.hide-subscribe button[aria-label="Subscribe: 25% off"],body.ffz-hide-purchase-options.hide-subscribe button[aria-label=Subscribe],body.ffz-hide-purchase-options.hide-subscribe button[data-a-target=subscribe-button-tier-1000],body.ffz-hide-purchase-options.hide-subscribe button[data-a-target=subscribe-button-tier-2000],body.ffz-hide-purchase-options.hide-subscribe button[data-a-target=subscribe-button-tier-3000]{display:none !important}body.ffz-hide-purchase-options.hide-subtember .subtember-gradient{display:none !important}body.ffz-hide-purchase-options.hide-update-sub button[aria-label="Update Subscription"]{display:none !important}'),l.subscribe("styles:reapply",H),new MutationObserver((e=>{e.forEach((e=>{"attributes"===e.type&&"class"===e.attributeName&&(e.target.classList.contains("ffz-hide-purchase-options")||l.publish("styles:reapply"))}))})).observe(document.body,{attributes:!0})},_=()=>{new p(a.Settings.Subscribe,a.Styles.Subscribe).listen()},L=()=>{new p(a.Settings.Subtember,a.Styles.Subtember).listen()},I=async()=>{a.InIframe||await((e,t=document.documentElement,s=1e4)=>new Promise((i=>{if(null===t)return null;if(t===document.documentElement&&(t=document.documentElement),t.querySelector(e))return i(t.querySelector(e));let n;const o=setTimeout((()=>{n.disconnect(),i(null)}),s);n=new MutationObserver((()=>{t.querySelector(e)&&(n.disconnect(),clearTimeout(o),i(t.querySelector(e)))})),n.observe(t,{childList:!0,subtree:!0})})))("nav .ffz-top-nav");new p(a.Settings.Turbo,a.Styles.Turbo,!1,(e=>{let t=null;for(const e of[...document.querySelectorAll('[data-a-target="top-nav-container"] [data-a-target="tw-core-button-label-text"]')])if("Get Ad-Free"===e.textContent.trim()){t=e;break}for(;t;){if(t.nextElementSibling?.classList?.contains("ffz-top-nav")){e?t.classList?.add(a.Styles.Base):t.classList?.remove(a.Styles.Base);break}t=t.parentElement}})).listen()},W=()=>{new p(a.Settings.UpdateSub,a.Styles.UpdateSub).listen()},M=()=>{new p(a.Settings.Extensions.EmotesShowcase,a.Styles.Extensions.EmotesShowcase,!0).listen()},R=()=>{new p(a.Settings.Extensions.FeaturedViewer,a.Styles.Extensions.FeaturedViewer,!0).listen()},B=()=>{new p(a.Settings.Extensions.LatestFollowers,a.Styles.Extensions.LatestFollowers,!0).listen()},$=()=>{new p(a.Settings.Extensions.MyEmotes,a.Styles.Extensions.MyEmotes,!0).listen()};(async()=>{await r((()=>a.InIframe?"complete"===document.readyState:!0===unsafeWindow.ffz?.addons?.loaded&&void 0!==unsafeWindow.ffz?.on)),c(0,[{name:"feature:settings-menu",task:k},{name:"feature:styles",task:v},{name:"feature:bits",task:h},{name:"feature:complete-purchase",task:m},{name:"feature:continue-sub",task:y},{name:"feature:gift",task:S},{name:"feature:manage-your-sub",task:w},{name:"feature:resubscribe",task:z},{name:"feature:subscribe",task:_},{name:"feature:subtember",task:L},{name:"feature:update-sub",task:W}],4),c(0,[{name:"feature-extension:emotes-showcase",task:M},{name:"feature-extension:featured-viewer",task:R},{name:"feature-extension:latest-followers",task:B},{name:"feature-extension:my-emotes",task:$}],4),c(0,[{name:"dynamic-feature:charity",task:f},{name:"dynamic-feature:hype-chat",task:g},{name:"dynamic-feature:turbo",task:I}],4)})()})();