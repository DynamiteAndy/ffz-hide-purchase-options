// ==UserScript==
// @name          FFZ Hide Purchase Options
// @namespace     dynamite-andy
// @version       2.2.1
// @iconURL       https://github.com/andrewcartwright1/ffz-hide-purchase-options/blob/main/src/resources/icons/favicon32x32.ico?raw=true
// @icon64URL     https://github.com/andrewcartwright1/ffz-hide-purchase-options/blob/main/src/resources/icons/favicon64x64.ico?raw=true
// @updateURL     https://github.com/andrewcartwright1/ffz-hide-purchase-options/raw/main/dist/ffz-hide-purchase-options.min.user.js
// @downloadURL   https://github.com/andrewcartwright1/ffz-hide-purchase-options/raw/main/dist/ffz-hide-purchase-options.min.user.js
// @supportURL    https://github.com/andrewcartwright1/ffz-hide-purchase-options/issues
// @description   Unofficial FFZ addon giving options to remove purchases from twitch
// @author        Dynamite Andy - dynamiteandy@gmail.com
// @include       http://twitch.tv/*
// @include       https://twitch.tv/*
// @include       http://*.twitch.tv/*
// @include       https://*.twitch.tv/*
// @include       http://*.ext-twitch.tv/*
// @include       https://*.ext-twitch.tv/*
// @exclude       http://api.twitch.tv/*
// @exclude       https://api.twitch.tv/*
// @run-at        document-start
// @grant         GM_getValue
// @grant         GM_setValue
// @grant         GM_deleteValue
// @grant         GM_addStyle
// @grant         GM_addValueChangeListener
// ==/UserScript==
(()=>{"use strict";var e,t,s,n,i=function(e,t,s){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:s?"".concat(s," ",t):t})};const a="addon.hide_purchase_options";class o{}o.InIframe="www.twitch.tv"!==window.location.host,o.IsExtension=window.location.host.endsWith("ext-twitch.tv"),o.Styles=(i(e=class{},"Styles"),e.Root="ffz-hide-purchase-options",e.Base="ffz-h-p-hide",e.GiftASub="hide-gift-a-sub",e.ManageYourSub="hide-manage-your-sub",e.Bits="hide-bits",e.Subscribe="hide-subscribe",e.Resubscribe="hide-resubscribe",e.ContinueSub="hide-continue-sub",e.UpdateSub="hide-update-sub",e.CompletePurchase="hide-complete-purchase",e.Subtember="hide-subtember",e.Turbo="hide-turbo",e.HypeChat="hide-hype-chat",e.Charity="hide-charity",e.Extensions=(i(t=class{},"Extensions"),t.EmotesShowcase="hide-emotes-showcase",t.LatestFollowers="hide-latest-followers",t.MyEmotes="hide-my-emotes",t.FeaturedViewer="hide-featured-viewer",t),e),o.Settings=(i(s=class{},"Settings"),s.prefix=`${a}.support-panel`,s.GiftASub=`${s.prefix}.gift_a_sub`,s.ManageYourSub=`${s.prefix}.go_above_and_beyond`,s.Bits=`${s.prefix}.bits`,s.ContinueSub=`${s.prefix}.continue_sub`,s.UpdateSub=`${s.prefix}.update_sub`,s.Subscribe=`${s.prefix}.subscribe`,s.Resubscribe=`${s.prefix}.resubscribe`,s.CompletePurchase=`${s.prefix}.complete_purchase`,s.Subtember=`${s.prefix}.subtember`,s.Turbo=`${s.prefix}.turbo`,s.HypeChat=`${s.prefix}.hype_chat`,s.Charity=`${s.prefix}.charity`,s.Extensions=(i(n=class{},"Extensions"),n.prefix=`${a}.support-panel.extensions`,n.Text=`${n.prefix}.text`,n.EmotesShowcase=`${n.prefix}.emotes_showcase`,n.LatestFollowers=`${n.prefix}.latest_followers`,n.MyEmotes=`${n.prefix}.my_emotes`,n.FeaturedViewer=`${n.prefix}.featured_viewer`,n),s);const u=e=>GM_getValue(e,!0),r=(e,t)=>{GM_setValue(e,t)},d=async(e,t=1e4)=>new Promise((s=>{const n=new Date,i=setInterval((()=>{e()?(clearInterval(i),s(!0)):+new Date-+n>t&&(clearInterval(i),s(!1))}),20)})),b=e=>()=>new Promise((t=>e((e=>t(e))))),c=async(e,t,s=3)=>{if(0===t.length)return Promise.resolve([]);let n=0;const i=[],a=async()=>{for(;n<t.length;){const e=n++,s="Function"===t[e].task.constructor.name?b(t[e].task):t[e].task;i[e]=await s()}},o=[];for(let e=0;e<s;e++)o.push(a());return await Promise.all(o),i};const l=function(){const e={};return{publish:(t,s)=>{(e[t]??[]).forEach((e=>e(s)))},subscribe:(t,s)=>{const n=e[t]??[];return n.push(s),e[t]=n,s},unsubscribe:(t,s)=>{let n=e[t]??[];n=n.filter((e=>e!==s)),e[t]=n}}}();class p{constructor(e,t,s=!1,n=null){this.applyClass=()=>{const e=u(this.settingId);this.setClass(e,!e,!1)},this.settingId=e,this.styleClass=t,this.tampermonkeySetting=s,this.settingFunction=n}listen(){l.subscribe("styles:reapply",this.applyClass),o.InIframe&&this.tampermonkeySetting?GM_addValueChangeListener(this.settingId,((e,t,s)=>this.setClass(s,t,!1))):o.InIframe||(unsafeWindow.ffz.addons.settings.getChanges(this.settingId,this.setClass.bind(this)),unsafeWindow.ffz.on("chat:room-add",this.applyClass),unsafeWindow.ffz.on("chat:room-remove",this.applyClass)),this.applyClass()}setClass(e,t,s=!0){this.tampermonkeySetting&&s&&r(this.settingId,e),e?document.body.classList.add(this.styleClass):document.body.classList.remove(this.styleClass),this.settingFunction&&this.settingFunction(e)}}const h=()=>{new p(o.Settings.Bits,o.Styles.Bits).listen()},f=async()=>{o.InIframe||await d((()=>null===unsafeWindow.ffz?.site?.elemental._observer));new p(o.Settings.Charity,o.Styles.Charity,!1,(e=>{let t=null;for(const e of[...document.querySelectorAll('[data-target="channel-header-right"] [data-a-target="tw-core-button-label-text"]')])if("Donate to Charity"===e.textContent.trim()){t=e;break}const s=t?.closest("button")?.parentElement,n=document.querySelector('[data-test-selector="chat-room-component-layout"] [aria-label="Charity details"]');e?(s?.classList?.add(o.Styles.Base),n?.classList?.add(o.Styles.Base),n?.previousElementSibling?.classList?.add(o.Styles.Base)):(s?.classList?.remove(o.Styles.Base),n?.classList?.remove(o.Styles.Base),n?.previousElementSibling?.classList?.remove(o.Styles.Base))})).listen()},y=async()=>{new p(o.Settings.CompletePurchase,o.Styles.CompletePurchase).listen()},m=async()=>{new p(o.Settings.ContinueSub,o.Styles.ContinueSub).listen()},S=async()=>{new p(o.Settings.GiftASub,o.Styles.GiftASub,!1,(async e=>{let t=null;const s=await((e,t=document.documentElement,s=1e4)=>new Promise((n=>{if(null===t)return[];if(t===document.documentElement&&(t=document.documentElement),t.querySelector(e))return n([...t.querySelectorAll(e)]);let i;const a=setTimeout((()=>{i.disconnect(),n([])}),s);i=new MutationObserver((()=>{t.querySelector(e)&&(i.disconnect(),clearTimeout(a),n([...t.querySelectorAll(e)]))})),i.observe(t,{childList:!0,subtree:!0})})))('.support-panel [data-a-target="tw-core-button-label-text"]');for(const e of s)if("Gift a Sub"===e.textContent.trim()){t=e;break}const n=t?.closest("button");e?n?.classList?.add(o.Styles.Base):n?.classList?.remove(o.Styles.Base)})).listen()},g=async()=>{o.InIframe||await d((()=>null===unsafeWindow.ffz?.site?.elemental._observer));new p(o.Settings.HypeChat,o.Styles.HypeChat,!1,(e=>{const t=document.querySelector('button[aria-label="Post a Hype Chat"]');e?t?.parentElement?.parentElement?.classList[e?"add":"remove"](o.Styles.Base):t?.parentElement?.parentElement?.classList.remove(o.Styles.Base)})).listen()},w=async()=>{new p(o.Settings.ManageYourSub,o.Styles.ManageYourSub).listen()},x=async()=>{new p(o.Settings.Resubscribe,o.Styles.Resubscribe).listen()},z="Add-Ons > Hide Purchase Options",C=`${z} >> Purchase Options`,E=`${z} >> Extensions`,k=async()=>{o.IsExtension||(unsafeWindow.ffz.addons.settings.addUI("add_ons.hide_purchase_options",{path:C,component:"container"}),unsafeWindow.ffz.addons.settings.add(o.Settings.Bits,{default:!0,ui:{path:C,title:'Hide "Get Bits"',description:'Hides the "Get Bits" payment option',component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(o.Settings.ContinueSub,{default:!0,ui:{path:C,title:'Hide "Continue Sub"',description:'Hides the "Continue Sub" payment option',component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(o.Settings.CompletePurchase,{default:!0,ui:{path:C,title:'Hide "Complete Purchase"',description:'Hides the "Complete Purchase" button',component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(o.Settings.Charity,{default:!0,ui:{path:C,title:'Hide "Donate To Charity"',description:'Hides the "Donate To Charity" payment option',component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(o.Settings.GiftASub,{default:!0,ui:{path:C,title:'Hide "Gift a Sub"',description:'Hides the "Gift a Sub" payment option',component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(o.Settings.HypeChat,{default:!0,ui:{path:C,title:'Hide "Hype Chat"',description:'Hides the "Hype Chat" payment option',component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(o.Settings.ManageYourSub,{default:!0,ui:{path:C,title:'Hide "Manage Your Sub"',description:'Hides the "Manage Your Sub" payment option',component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(o.Settings.Resubscribe,{default:!0,ui:{path:C,title:'Hide "Resubscribe"',description:'Hides the "Resubscribe" payment option',component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(o.Settings.Subscribe,{default:!0,ui:{path:C,title:'Hide "Subscribe"',description:'Hides the "Subscribe" payment option',component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(o.Settings.Subtember,{default:!0,ui:{path:C,title:'Hide "Subtember"',description:'Hides the "Subtember" advert',component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(o.Settings.Turbo,{default:!0,ui:{path:C,title:'Hide "Turbo"',description:'Hides the "Turbo" payment option',component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(o.Settings.UpdateSub,{default:!0,ui:{path:C,title:'Hide "Update Sub"',description:'Hides the "Update Subscription" payment option',component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(o.Settings.Extensions.EmotesShowcase,{default:!0,ui:{path:E,title:'Hide "Emotes Showcase"',description:"Hides payment options on the Emotes Showcase extension",component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(o.Settings.Extensions.FeaturedViewer,{default:!0,ui:{path:E,title:'Hide "Featured Viewer"',description:"Hides payment options on the Featured Viewer extension",component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(o.Settings.Extensions.LatestFollowers,{default:!0,ui:{path:E,title:'Hide "Latest Followers"',description:"Hides payment options on the Latest Followers extension",component:"setting-check-box"}}),unsafeWindow.ffz.addons.settings.add(o.Settings.Extensions.MyEmotes,{default:!0,ui:{path:E,title:'Hide "MyEmotes',description:"Hides payment options on the MyEmotes extension",component:"setting-check-box"}}))},v=()=>document.body.classList.add(o.Styles.Root),H=async()=>{v(),GM_addStyle('body.ffz-hide-purchase-options .ffz-h-p-hide{display:none !important}body.ffz-hide-purchase-options.hide-bits button[aria-label=Bits],body.ffz-hide-purchase-options.hide-bits button[data-test-selector=get-bits-button],body.ffz-hide-purchase-options.hide-bits button[data-a-target=top-nav-get-bits-button],body.ffz-hide-purchase-options.hide-bits button[data-a-target=bits-purchase-button-100],body.ffz-hide-purchase-options.hide-bits button[data-a-target=bits-purchase-button-500],body.ffz-hide-purchase-options.hide-bits button[data-a-target=bits-purchase-button-1500],body.ffz-hide-purchase-options.hide-bits button[data-a-target=bits-purchase-button-5000],body.ffz-hide-purchase-options.hide-bits button[data-a-target=bits-purchase-button-10000],body.ffz-hide-purchase-options.hide-bits button[data-a-target=bits-purchase-button-25000],body.ffz-hide-purchase-options.hide-bits a[data-test-selector=test_selector_buy_bits_button]{display:none !important}body.ffz-hide-purchase-options.hide-manage-your-sub button[data-a-target=spm-complete-purchase-button]{display:none !important}body.ffz-hide-purchase-options.hide-continue-sub button[aria-label="Continue Sub"],body.ffz-hide-purchase-options.hide-continue-sub button[aria-label="Continue Sub - 7 Days Remaining"],body.ffz-hide-purchase-options.hide-continue-sub button[aria-label="Continue Sub - 6 Days Remaining"],body.ffz-hide-purchase-options.hide-continue-sub button[aria-label="Continue Sub - 5 Days Remaining"],body.ffz-hide-purchase-options.hide-continue-sub button[aria-label="Continue Sub - 4 Days Remaining"],body.ffz-hide-purchase-options.hide-continue-sub button[aria-label="Continue Sub - 3 Days Remaining"],body.ffz-hide-purchase-options.hide-continue-sub button[aria-label="Continue Sub: 25% off"],body.ffz-hide-purchase-options.hide-continue-sub button[data-test-selector=PaidUpgradeButton]{display:none !important}body.ffz-hide-purchase-options.hide-emotes-showcase a[title=Subscribe],body.ffz-hide-purchase-options.hide-emotes-showcase a[title="Subscribe for"]{display:none !important}body.ffz-hide-purchase-options.hide-emotes-showcase button#overlaysub{display:none !important}body.ffz-hide-purchase-options.hide-featured-viewer button.shoutout__button--me{display:none !important}body.ffz-hide-purchase-options.hide-latest-followers[data-active=recent] #recent-panel .btn.buy{display:none !important}body.ffz-hide-purchase-options.hide-my-emotes #root .extension-mode-navigation a[href*="https://twitch.tv/subs/"]{display:none !important}body.ffz-hide-purchase-options.hide-gift-a-sub button[aria-label="Gift a Sub"],body.ffz-hide-purchase-options.hide-gift-a-sub button[data-test-selector=gift-subscribe-button],body.ffz-hide-purchase-options.hide-gift-a-sub button[data-test-selector=take-the-leaderboard-prompt-button]{display:none !important}body.ffz-hide-purchase-options.hide-hype-chat button[aria-label="Hype Chat"]{display:none !important}body.ffz-hide-purchase-options.hide-manage-your-sub button[aria-label="Manage Your Sub: 25% off"],body.ffz-hide-purchase-options.hide-manage-your-sub button[aria-label="Manage Your Sub"]{display:none !important}body.ffz-hide-purchase-options.hide-resubscribe button[aria-label="Resubscribe: 25% off"],body.ffz-hide-purchase-options.hide-resubscribe button[aria-label=Resubscribe]{display:none !important}body.ffz-hide-purchase-options.hide-subscribe button[aria-label="Subscribe: 25% off"],body.ffz-hide-purchase-options.hide-subscribe button[aria-label=Subscribe],body.ffz-hide-purchase-options.hide-subscribe button[data-a-target=subscribe-button-tier-1000],body.ffz-hide-purchase-options.hide-subscribe button[data-a-target=subscribe-button-tier-2000],body.ffz-hide-purchase-options.hide-subscribe button[data-a-target=subscribe-button-tier-3000]{display:none !important}body.ffz-hide-purchase-options.hide-subtember .subtember-gradient{display:none !important}body.ffz-hide-purchase-options.hide-update-sub button[aria-label="Update Subscription"]{display:none !important}'),l.subscribe("styles:reapply",v),new MutationObserver((e=>{e.forEach((e=>{"attributes"===e.type&&"class"===e.attributeName&&(e.target.classList.contains("ffz-hide-purchase-options")||l.publish("styles:reapply"))}))})).observe(document.body,{attributes:!0})},_=async()=>{new p(o.Settings.Subscribe,o.Styles.Subscribe).listen()},L=async()=>{new p(o.Settings.Subtember,o.Styles.Subtember).listen()},I=async()=>{o.InIframe||await((e,t=document.documentElement,s=1e4)=>new Promise((n=>{if(null===t)return null;if(t===document.documentElement&&(t=document.documentElement),t.querySelector(e))return n(t.querySelector(e));let i;const a=setTimeout((()=>{i.disconnect(),n(null)}),s);i=new MutationObserver((()=>{t.querySelector(e)&&(i.disconnect(),clearTimeout(a),n(t.querySelector(e)))})),i.observe(t,{childList:!0,subtree:!0})})))("nav .ffz-top-nav");new p(o.Settings.Turbo,o.Styles.Turbo,!1,(e=>{let t=null;for(const e of[...document.querySelectorAll('[data-a-target="top-nav-container"] [data-a-target="tw-core-button-label-text"]')])if("Get Ad-Free"===e.textContent.trim()){t=e;break}for(;t;){if(t.nextElementSibling?.classList?.contains("ffz-top-nav")){e?t.classList?.add(o.Styles.Base):t.classList?.remove(o.Styles.Base);break}t=t.parentElement}})).listen()},W=async()=>{new p(o.Settings.UpdateSub,o.Styles.UpdateSub).listen()},M=async()=>{new p(o.Settings.Extensions.EmotesShowcase,o.Styles.Extensions.EmotesShowcase,!0).listen()},B=async()=>{new p(o.Settings.Extensions.FeaturedViewer,o.Styles.Extensions.FeaturedViewer,!0).listen()},$=async()=>{new p(o.Settings.Extensions.LatestFollowers,o.Styles.Extensions.LatestFollowers,!0).listen()},F=async()=>{new p(o.Settings.Extensions.MyEmotes,o.Styles.Extensions.MyEmotes,!0).listen()};(async()=>{o.IsExtension;await d((()=>o.InIframe?"complete"===document.readyState:!0===unsafeWindow.ffz?.addons?.loaded&&void 0!==unsafeWindow.ffz?.on)),c(0,[{name:"feature:settings-menu",task:k},{name:"feature:styles",task:H},{name:"feature:bits",task:h},{name:"feature:complete-purchase",task:y},{name:"feature:continue-sub",task:m},{name:"feature:gift",task:S},{name:"feature:manage-your-sub",task:w},{name:"feature:resubscribe",task:x},{name:"feature:subscribe",task:_},{name:"feature:subtember",task:L},{name:"feature:update-sub",task:W}],4),c(0,[{name:"feature-extension:emotes-showcase",task:M},{name:"feature-extension:featured-viewer",task:B},{name:"feature-extension:latest-followers",task:$},{name:"feature-extension:my-emotes",task:F}],4),c(0,[{name:"dynamic-feature:charity",task:f},{name:"dynamic-feature:hype-chat",task:g},{name:"dynamic-feature:turbo",task:I}],4)})()})();